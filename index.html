<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C√¢mera com Slow, Zoom e QRCode</title>
<style>
  body {
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
  }

  #container-gravacao, #container-visualizacao, #container-qrcode {
    display: none;
    padding: 20px;
  }

  #container-gravacao {
    display: block; /* vis√≠vel inicialmente */
  }

  video {
    width: 100%;
    max-width: 500px;
    border: 2px solid gold;
    border-radius: 10px;
    display: block;
    margin: 0 auto;
    transform-origin: center center; /* para zoom funcionar no v√≠deo */
  }

  button {
    padding: 10px 20px;
    margin-top: 10px;
    font-size: 16px;
    background: gold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="container-gravacao">
  <h2>üé• Grava√ß√£o</h2>
  <video id="preview" autoplay playsinline></video>
  <br>
  <button id="startBtn">üé¨ Gravar</button>
</div>

<div id="container-visualizacao">
  <h2>‚ñ∂Ô∏è Visualiza√ß√£o</h2>
  <video id="playback" controls></video>
  <br>
  <button id="gerarQRBtn">üì± Gerar QR Code</button>
</div>

<div id="container-qrcode">
  <h2>üì± QR Code</h2>
  <div id="qrcode"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
let mediaRecorder;
let recordedChunks = [];
let stream;

// Inicia c√¢mera sem √°udio
async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" } // sem √°udio
  });
  document.getElementById('preview').srcObject = stream;
}

startCamera();

// Bot√£o Gravar
document.getElementById('startBtn').addEventListener('click', () => {
  recordedChunks = [];
  mediaRecorder = new MediaRecorder(stream);

  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) recordedChunks.push(e.data);
  };

  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    const url = URL.createObjectURL(blob);
    const playback = document.getElementById('playback');
    playback.src = url;

    document.getElementById('container-gravacao').style.display = 'none';
    document.getElementById('container-visualizacao').style.display = 'block';

    // Ativa zoom org√¢nico apenas depois que o v√≠deo aparecer
    startOrganicZoom(playback);
  };

  mediaRecorder.start();

  // Para automaticamente em 10s
  setTimeout(() => mediaRecorder.stop(), 10000);
});

// Fun√ß√£o de zoom org√¢nico usando requestAnimationFrame
function startOrganicZoom(video) {
  let scale = 1;
  let direction = 1; // 1 = aumenta, -1 = diminui
  const speed = 0.0008; // velocidade do zoom

  function zoom() {
    scale += direction * speed;
    if (scale > 1.5) direction = -1;
    if (scale < 1) direction = 1;
    video.style.transform = `scale(${scale})`;
    requestAnimationFrame(zoom);
  }

  video.playbackRate = 0.5; // come√ßa slow motion
  setInterval(() => {
    video.playbackRate = video.playbackRate === 0.5 ? 2 : 0.5; // alterna velocidade
  }, 4000);

  zoom(); // inicia o zoom org√¢nico
}

// Gerar QR Code
document.getElementById('gerarQRBtn').addEventListener('click', () => {
  const blob = new Blob(recordedChunks, { type: 'video/webm' });
  const url = URL.createObjectURL(blob);
  document.getElementById('qrcode').innerHTML = '';
  new QRCode(document.getElementById('qrcode'), url);

  document.getElementById('container-visualizacao').style.display = 'none';
  document.getElementById('container-qrcode').style.display = 'block';
});
</script>

</body>
</html>
